<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ewe Care - Sheep Health Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        body { background-color: #f0f2f5; color: #333; }
        .header-section { background-color: #fff; padding: 2rem 0; margin-bottom: 2rem; }
        .main-container { background-color: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .hidden { display: none; }
        .status-healthy { color: #28a745; font-weight: bold; }
        .status-sick { color: #dc3545; font-weight: bold; }
        .status-treatment { color: #ffc107; font-weight: bold; }
        .loading { font-style: italic; color: #6c757d; }
        .nav-link.active { font-weight: bold; color: #007bff !important; }
    </style>
</head>
<body>
    <header class="header-section text-center">
        <h1 class="display-4 text-primary">üêè Ewe Care</h1>
        <p class="lead text-muted">A simple application to track the health of your flock.</p>
    </header>
    <div id="authSection" class="container main-container">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="email" id="loginEmail" class="form-control mb-2" placeholder="Email" required>
        <input type="password" id="loginPassword" class="form-control mb-2" placeholder="Password" required>
        <button type="submit" class="btn btn-primary">Login</button>
      </form>
      <form id="registerForm" style="display:none;">
        <input type="email" id="registerEmail" class="form-control mb-2" placeholder="Email" required>
        <input type="password" id="registerPassword" class="form-control mb-2" placeholder="Password" required>
        <button type="submit" class="btn btn-success">Register</button>
        <button type="button" class="btn btn-link" onclick="showLogin()">Back to Login</button>
      </form>
      <div id="authError" class="text-danger mt-2"></div>
    </div>
    <div class="container main-container" id="mainApp" style="display:none;">
        <div class="d-flex justify-content-end mb-2">
            <button id="signOutBtn" class="btn btn-outline-danger btn-sm">Sign Out</button>
        </div>
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item"><a class="nav-link active" href="#" onclick="showSection('home', this)">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('records', this)">Records</a></li>
            <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('treatment', this)">Treatment</a></li>
        </ul>
        <!-- Home Section -->
        <div id="homeSection">
            <h2 class="mb-4">Add New Health Record</h2>
            <form id="sheepHealthForm">
                <div class="mb-3">
                    <label for="sheepId" class="form-label">Sheep ID</label>
                    <input type="text" class="form-control" id="sheepId" required>
                </div>
                <div class="mb-3">
                    <label for="healthStatus" class="form-label">Health Status</label>
                    <select class="form-select" id="healthStatus" required>
                        <option value="Healthy">Healthy</option>
                        <option value="Sick">Sick</option>
                        <option value="Under Treatment">Under Treatment</option>
                        <option value="Recovering">Recovering</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="dateRecorded" class="form-label">Date Recorded</label>
                    <input type="date" class="form-control" id="dateRecorded" required>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="weight" class="form-label">Weight (kg)</label>
                        <input type="number" step="0.1" class="form-control" id="weight">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="temperature" class="form-label">Temperature (¬∞C)</label>
                        <input type="number" step="0.1" class="form-control" id="temperature">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="notes" class="form-label">Notes</label>
                    <textarea class="form-control" id="notes" rows="3"></textarea>
                </div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">Reset</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-plus-circle"></i> Add Record</button>
                </div>
            </form>
        </div>
        <!-- Records Section -->
        <div id="recordsSection" class="hidden">
            <h2 class="mb-4">All Health Records</h2>
            <div class="table-responsive">
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <th>Sheep ID</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Weight</th>
                            <th>Temp</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="sheepHealthTableBody"></tbody>
                </table>
            </div>
        </div>
        <!-- Treatment Section -->
        <div id="treatmentSection" class="hidden">
            <h2 class="mb-4">Treatment & Symptoms Log</h2>
            <div class="table-responsive">
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <th>Sheep ID</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Weight</th>
                            <th>Temp</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="treatmentLogTableBody"></tbody>
                </table>
            </div>
        </div>
        <!-- Edit Modal -->
        <div class="modal fade" id="editSheepModal" tabindex="-1" aria-labelledby="editSheepModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <form class="modal-content" id="editSheepForm">
              <div class="modal-header">
                <h5 class="modal-title" id="editSheepModalLabel">Edit Sheep Health Record</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <input type="hidden" id="editRecordId">
                <div class="mb-3">
                  <label for="editSheepId" class="form-label">Sheep ID</label>
                  <input type="text" class="form-control" id="editSheepId" required>
                </div>
                <div class="mb-3">
                  <label for="editHealthStatus" class="form-label">Health Status</label>
                  <select class="form-select" id="editHealthStatus" required>
                    <option value="Healthy">Healthy</option>
                    <option value="Sick">Sick</option>
                    <option value="Under Treatment">Under Treatment</option>
                    <option value="Recovering">Recovering</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="editDateRecorded" class="form-label">Date Recorded</label>
                  <input type="date" class="form-control" id="editDateRecorded" required>
                </div>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="editWeight" class="form-label">Weight (kg)</label>
                    <input type="number" step="0.1" class="form-control" id="editWeight">
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="editTemperature" class="form-label">Temperature (¬∞C)</label>
                    <input type="number" step="0.1" class="form-control" id="editTemperature">
                  </div>
                </div>
                <div class="mb-3">
                  <label for="editNotes" class="form-label">Notes</label>
                  <textarea class="form-control" id="editNotes" rows="3"></textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyBdiEUorFPkiZAya84Xzx17id82nB77Zg4",
        authDomain: "sheep-1b6a7.firebaseapp.com",
        databaseURL: "https://sheep-1b6a7-default-rtdb.firebaseio.com",
        projectId: "sheep-1b6a7",
        storageBucket: "sheep-1b6a7.firebasestorage.app",
        messagingSenderId: "243565434909",
        appId: "1:243565434909:web:25312f89033e3fd0d54ef4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- AUTH LOGIC ---
    firebase.auth().onAuthStateChanged(function(user) {
        document.getElementById('authSection').style.display = user ? 'none' : '';
        document.getElementById('mainApp').style.display = user ? '' : 'none';
        if (user) showSection('home', document.querySelector('.nav-link.active'));
    });
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      firebase.auth().signInWithEmailAndPassword(email, password)
        .catch(function(error) {
          document.getElementById('authError').textContent = error.message;
        });
    });
    document.getElementById('registerForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then(function() { showLogin(); })
        .catch(function(error) {
          document.getElementById('authError').textContent = error.message;
        });
    });
    function showLogin() {
      document.getElementById('loginForm').style.display = '';
      document.getElementById('registerForm').style.display = 'none';
      document.getElementById('authError').textContent = '';
    }
    document.getElementById('signOutBtn').addEventListener('click', function() {
      firebase.auth().signOut();
    });

    // --- SECTION CONTROL ---
    function showSection(section, el) {
        ['homeSection', 'recordsSection', 'treatmentSection'].forEach(s => document.getElementById(s).classList.add('hidden'));
        document.getElementById(section+'Section').classList.remove('hidden');
        document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
        if (el) el.classList.add('active');
        if (section === 'records') fetchHealthRecords();
        if (section === 'treatment') fetchTreatmentRecords();
    }

    // --- ADD RECORD ---
    document.getElementById('dateRecorded').valueAsDate = new Date();
    function resetForm() {
        sheepHealthForm.reset();
        document.getElementById('dateRecorded').valueAsDate = new Date();
    }
    document.getElementById('sheepHealthForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const sheepId = document.getElementById('sheepId').value.trim();
        const healthStatus = document.getElementById('healthStatus').value;
        const dateRecorded = document.getElementById('dateRecorded').value;
        const weight = document.getElementById('weight').value;
        const temperature = document.getElementById('temperature').value;
        const notes = document.getElementById('notes').value.trim();
        const record = { sheepId, healthStatus, dateRecorded, notes, timestamp: new Date().toISOString() };
        if (weight) record.weight = parseFloat(weight);
        if (temperature) record.temperature = parseFloat(temperature);
        db.ref("sheepHealthRecords").push(record)
            .then(() => {
                sheepHealthForm.reset();
                document.getElementById('dateRecorded').valueAsDate = new Date();
                fetchHealthRecords();
                fetchTreatmentRecords();
            });
    });

    // --- TABLES ---
    function getStatusClass(status) {
        switch (status) {
            case 'Healthy': return 'status-healthy';
            case 'Sick': return 'status-sick';
            case 'Under Treatment': case 'Recovering': return 'status-treatment';
            default: return '';
        }
    }
    // Fetch All Health Records (Healthy/Recovering only)
    function fetchHealthRecords() {
      const tbody = document.getElementById('sheepHealthTableBody');
      tbody.innerHTML = '<tr><td colspan="7">Loading...</td></tr>';
      db.ref("sheepHealthRecords").once("value", (snapshot) => {
        tbody.innerHTML = '';
        snapshot.forEach(child => {
          const record = { id: child.key, ...child.val() };
          if (record.healthStatus === 'Healthy' || record.healthStatus === 'Recovering') {
            tbody.innerHTML += renderRecordRow(record, false);
          }
        });
        if (!tbody.innerHTML) tbody.innerHTML = '<tr><td colspan="7">No records</td></tr>';
      });
    }
    // Fetch Treatment Records (Sick/Under Treatment only)
    function fetchTreatmentRecords() {
      const tbody = document.getElementById('treatmentLogTableBody');
      tbody.innerHTML = '<tr><td colspan="7">Loading...</td></tr>';
      db.ref("sheepHealthRecords").once("value", (snapshot) => {
        tbody.innerHTML = '';
        snapshot.forEach(child => {
          const record = { id: child.key, ...child.val() };
          if (record.healthStatus === 'Sick' || record.healthStatus === 'Under Treatment') {
            tbody.innerHTML += renderRecordRow(record, true);
          }
        });
        if (!tbody.innerHTML) tbody.innerHTML = '<tr><td colspan="7">No sick/treatment records</td></tr>';
      });
    }
    function renderRecordRow(record, isTreatmentTab) {
      return `
        <tr>
          <td>${record.sheepId}</td>
          <td class="${getStatusClass(record.healthStatus)}">${record.healthStatus}</td>
          <td>${record.dateRecorded || ''}</td>
          <td>${record.weight || ''}</td>
          <td>${record.temperature || ''}</td>
          <td>${record.notes || ''}</td>
          <td>
            <button class="btn btn-sm btn-primary" onclick="editRecord('${record.id}', '${isTreatmentTab ? 'treatment' : 'records'}')">Edit</button>
          </td>
        </tr>
      `;
    }

    // --- EDIT MODAL ---
    function editRecord(id, tab) {
      db.ref(`sheepHealthRecords/${id}`).once("value", (snap) => {
        if (!snap.exists()) return;
        const r = snap.val();
        document.getElementById('editRecordId').value = id;
        document.getElementById('editSheepId').value = r.sheepId;
        document.getElementById('editHealthStatus').value = r.healthStatus;
        document.getElementById('editDateRecorded').value = r.dateRecorded || '';
        document.getElementById('editWeight').value = r.weight || '';
        document.getElementById('editTemperature').value = r.temperature || '';
        document.getElementById('editNotes').value = r.notes || '';
        document.getElementById('editSheepModal').dataset.tab = tab;
        new bootstrap.Modal(document.getElementById('editSheepModal')).show();
      });
    }
    document.getElementById('editSheepForm').addEventListener('submit', function(e){
      e.preventDefault();
      const id = document.getElementById('editRecordId').value;
      const sheepId = document.getElementById('editSheepId').value;
      const healthStatus = document.getElementById('editHealthStatus').value;
      const dateRecorded = document.getElementById('editDateRecorded').value;
      const weight = document.getElementById('editWeight').value;
      const temperature = document.getElementById('editTemperature').value;
      const notes = document.getElementById('editNotes').value;
      db.ref(`sheepHealthRecords/${id}`).update({
        sheepId, healthStatus, dateRecorded, weight, temperature, notes
      }).then(() => {
        bootstrap.Modal.getInstance(document.getElementById('editSheepModal')).hide();
        fetchHealthRecords();
        fetchTreatmentRecords();
      });
    });
    </script>
</body>
</html>